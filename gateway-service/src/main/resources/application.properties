spring.application.name=gateway-service
server.port=8080

eureka.client.service-url.defaultZone=http://discovery-service:8761/eureka/
eureka.client.registry-fetch-interval-seconds=5
eureka.client.initial-instance-info-replication-interval-seconds=5
eureka.instance.lease-renewal-interval-in-seconds=5

spring.cloud.gateway.server.webflux.discovery.locator.enabled=false

spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD}
spring.data.redis.timeout=2000ms
spring.data.redis.connect-timeout=2000ms

# Redis Connection Pool
spring.data.redis.lettuce.pool.max-active=200
spring.data.redis.lettuce.pool.max-idle=100
spring.data.redis.lettuce.pool.min-idle=50

logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.springframework.cloud.gateway.filter.ratelimit=DEBUG
jwt.secret=${SECRET_TOKEN}


# ========================================
# CIRCUIT BREAKER CONFIGURATION (Resilience4j)
# ========================================

# Auth Service - Security Critical
resilience4j.circuitbreaker.instances.AuthCircuitBreaker.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.AuthCircuitBreaker.sliding-window-size=1000
resilience4j.circuitbreaker.instances.AuthCircuitBreaker.minimum-number-of-calls=50
resilience4j.circuitbreaker.instances.AuthCircuitBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.AuthCircuitBreaker.wait-duration-in-open-state=15s
resilience4j.circuitbreaker.instances.AuthCircuitBreaker.permitted-number-of-calls-in-half-open-state=20
resilience4j.circuitbreaker.instances.AuthCircuitBreaker.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.timelimiter.instances.AuthCircuitBreaker.timeout-duration=20s
resilience4j.bulkhead.instances.AuthCircuitBreaker.max-concurrent-calls=500
resilience4j.bulkhead.instances.AuthCircuitBreaker.max-wait-duration=0

# User Service - Standard
resilience4j.circuitbreaker.instances.UserCircuitBreaker.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.UserCircuitBreaker.sliding-window-size=500
resilience4j.circuitbreaker.instances.UserCircuitBreaker.minimum-number-of-calls=20
resilience4j.circuitbreaker.instances.UserCircuitBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.UserCircuitBreaker.wait-duration-in-open-state=15s
resilience4j.circuitbreaker.instances.UserCircuitBreaker.permitted-number-of-calls-in-half-open-state=20
resilience4j.circuitbreaker.instances.UserCircuitBreaker.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.timelimiter.instances.UserCircuitBreaker.timeout-duration=10s
resilience4j.bulkhead.instances.UserCircuitBreaker.max-concurrent-calls=200
resilience4j.bulkhead.instances.UserCircuitBreaker.max-wait-duration=0

# Movie Service - Read Heavy (more tolerant)
resilience4j.circuitbreaker.instances.MovieCircuitBreaker.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.MovieCircuitBreaker.sliding-window-size=1000
resilience4j.circuitbreaker.instances.MovieCircuitBreaker.minimum-number-of-calls=50
resilience4j.circuitbreaker.instances.MovieCircuitBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.MovieCircuitBreaker.wait-duration-in-open-state=10s
resilience4j.circuitbreaker.instances.MovieCircuitBreaker.permitted-number-of-calls-in-half-open-state=20
resilience4j.circuitbreaker.instances.MovieCircuitBreaker.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.timelimiter.instances.MovieCircuitBreaker.timeout-duration=20s
resilience4j.bulkhead.instances.MovieCircuitBreaker.max-concurrent-calls=300
resilience4j.bulkhead.instances.MovieCircuitBreaker.max-wait-duration=0

# Theater Service - Read Heavy (more tolerant)
resilience4j.circuitbreaker.instances.TheaterCircuitBreaker.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.TheaterCircuitBreaker.sliding-window-size=1000
resilience4j.circuitbreaker.instances.TheaterCircuitBreaker.minimum-number-of-calls=50
resilience4j.circuitbreaker.instances.TheaterCircuitBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.TheaterCircuitBreaker.wait-duration-in-open-state=10s
resilience4j.circuitbreaker.instances.TheaterCircuitBreaker.permitted-number-of-calls-in-half-open-state=20  
resilience4j.circuitbreaker.instances.TheaterCircuitBreaker.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.timelimiter.instances.TheaterCircuitBreaker.timeout-duration=20s
resilience4j.bulkhead.instances.TheaterCircuitBreaker.max-concurrent-calls=300
resilience4j.bulkhead.instances.TheaterCircuitBreaker.max-wait-duration=0

# Show Service - Complex Dependencies (needs faster recovery)
resilience4j.circuitbreaker.instances.ShowCircuitBreaker.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.ShowCircuitBreaker.sliding-window-size=2000
resilience4j.circuitbreaker.instances.ShowCircuitBreaker.minimum-number-of-calls=100
resilience4j.circuitbreaker.instances.ShowCircuitBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.ShowCircuitBreaker.wait-duration-in-open-state=10s
resilience4j.circuitbreaker.instances.ShowCircuitBreaker.permitted-number-of-calls-in-half-open-state=20
resilience4j.circuitbreaker.instances.ShowCircuitBreaker.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.timelimiter.instances.ShowCircuitBreaker.timeout-duration=60s
resilience4j.bulkhead.instances.ShowCircuitBreaker.max-concurrent-calls=500
resilience4j.bulkhead.instances.ShowCircuitBreaker.max-wait-duration=0

# Reservation Service - Critical Write Operations
resilience4j.circuitbreaker.instances.ReservationCircuitBreaker.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.ReservationCircuitBreaker.sliding-window-size=500
resilience4j.circuitbreaker.instances.ReservationCircuitBreaker.minimum-number-of-calls=20
resilience4j.circuitbreaker.instances.ReservationCircuitBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.ReservationCircuitBreaker.wait-duration-in-open-state=15s
resilience4j.circuitbreaker.instances.ReservationCircuitBreaker.permitted-number-of-calls-in-half-open-state=10
resilience4j.circuitbreaker.instances.ReservationCircuitBreaker.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.timelimiter.instances.ReservationCircuitBreaker.timeout-duration=30s
resilience4j.bulkhead.instances.ReservationCircuitBreaker.max-concurrent-calls=200
resilience4j.bulkhead.instances.ReservationCircuitBreaker.max-wait-duration=0

# Seat Service - High Concurrency
resilience4j.circuitbreaker.instances.SeatCircuitBreaker.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.SeatCircuitBreaker.sliding-window-size=1000
resilience4j.circuitbreaker.instances.SeatCircuitBreaker.minimum-number-of-calls=50
resilience4j.circuitbreaker.instances.SeatCircuitBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.SeatCircuitBreaker.wait-duration-in-open-state=15s
resilience4j.circuitbreaker.instances.SeatCircuitBreaker.permitted-number-of-calls-in-half-open-state=20
resilience4j.circuitbreaker.instances.SeatCircuitBreaker.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.timelimiter.instances.SeatCircuitBreaker.timeout-duration=20s
resilience4j.bulkhead.instances.SeatCircuitBreaker.max-concurrent-calls=300
resilience4j.bulkhead.instances.SeatCircuitBreaker.max-wait-duration=0

# Notification Service - Non-Critical (most tolerant)
resilience4j.circuitbreaker.instances.NotificationCircuitBreaker.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.NotificationCircuitBreaker.sliding-window-size=200
resilience4j.circuitbreaker.instances.NotificationCircuitBreaker.minimum-number-of-calls=10
resilience4j.circuitbreaker.instances.NotificationCircuitBreaker.failure-rate-threshold=70
resilience4j.circuitbreaker.instances.NotificationCircuitBreaker.wait-duration-in-open-state=20s
resilience4j.circuitbreaker.instances.NotificationCircuitBreaker.permitted-number-of-calls-in-half-open-state=20
resilience4j.circuitbreaker.instances.NotificationCircuitBreaker.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.timelimiter.instances.NotificationCircuitBreaker.timeout-duration=10s
resilience4j.bulkhead.instances.NotificationCircuitBreaker.max-concurrent-calls=100
resilience4j.bulkhead.instances.NotificationCircuitBreaker.max-wait-duration=0

# Payment Service - Financial Critical (strictest)
resilience4j.circuitbreaker.instances.PaymentCircuitBreaker.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.PaymentCircuitBreaker.sliding-window-size=200
resilience4j.circuitbreaker.instances.PaymentCircuitBreaker.minimum-number-of-calls=10
resilience4j.circuitbreaker.instances.PaymentCircuitBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.PaymentCircuitBreaker.wait-duration-in-open-state=15s
resilience4j.circuitbreaker.instances.PaymentCircuitBreaker.permitted-number-of-calls-in-half-open-state=20
resilience4j.circuitbreaker.instances.PaymentCircuitBreaker.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.timelimiter.instances.PaymentCircuitBreaker.timeout-duration=30s
resilience4j.bulkhead.instances.PaymentCircuitBreaker.max-concurrent-calls=100
resilience4j.bulkhead.instances.PaymentCircuitBreaker.max-wait-duration=0
